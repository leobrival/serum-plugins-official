---
description: Accessibility audit based on RGAA 4.1 and WCAG 2.1 standards
allowed-tools: Bash, Read, Write, Task, mcp__chrome-devtools__*
argument-hint: <url> [--output ./audits/]
arguments:
  - name: URL
    default: ""
  - name: OutputDir
    default: "./audits"
---

# Accessibility Audit (RGAA 4.1)

Performs comprehensive accessibility audit based on RGAA 4.1 (French accessibility standards) and WCAG 2.1 guidelines.

## Arguments

- **URL** ($URL): Target website URL to audit
- **OutputDir** ($OUTPUT_DIR): Directory for audit report (default: "./audits")

## Task

You are an accessibility auditor specializing in RGAA 4.1 and WCAG 2.1 compliance.

### Step 1: Preparation

```bash
# Create output directory
mkdir -p $OUTPUT_DIR

# Generate timestamp for report
TIMESTAMP=$(date +%Y%m%d-%H%M%S)
REPORT_FILE="$OUTPUT_DIR/a11y-$TIMESTAMP.md"
```

### Step 2: Execute Audit (3-Level Fallback)

#### Level 1: CLI Tools (Preferred)

Try axe-core or pa11y CLI:

```bash
# Option A: axe-core
if command -v axe &> /dev/null; then
  axe $URL --save $OUTPUT_DIR/axe-results.json
fi

# Option B: pa11y
if command -v pa11y &> /dev/null; then
  pa11y $URL --reporter json > $OUTPUT_DIR/pa11y-results.json
fi

# Option C: Lighthouse accessibility audit
if command -v lighthouse &> /dev/null; then
  lighthouse $URL --only-categories=accessibility --output json --output-path $OUTPUT_DIR/lighthouse-a11y.json
fi
```

#### Level 2: Chrome DevTools MCP

If CLI unavailable:

```typescript
// Use Chrome DevTools MCP to:
// 1. Navigate to URL
mcp__chrome-devtools__navigate_page({ url: $URL })

// 2. Take accessibility snapshot
mcp__chrome-devtools__take_snapshot({ verbose: true })

// 3. Run Lighthouse via DevTools
mcp__chrome-devtools__performance_start_trace({ reload: true })
// ... analyze results
```

#### Level 3: Manual Agent Analysis

If both fail, invoke a11y-auditor agent:

```bash
# Use Task tool with a11y-auditor agent
Task(subagent_type="a11y-auditor", prompt="Audit $URL for RGAA 4.1 compliance")
```

### Step 3: Analyze Results

Parse and categorize findings by RGAA criteria:

1. **Images** (Crit√®re 1) - Alt text, decorative images
2. **Frames** (Crit√®re 2) - Frame titles
3. **Colors** (Crit√®re 3) - Contrast ratios
4. **Multimedia** (Crit√®re 4) - Transcripts, captions
5. **Tables** (Crit√®re 5) - Headers, summaries
6. **Links** (Crit√®re 6) - Link text clarity
7. **Scripts** (Crit√®re 7) - JavaScript accessibility
8. **Mandatory Elements** (Crit√®re 8) - Doctype, lang, title
9. **Document Structure** (Crit√®re 9) - Headings hierarchy
10. **Presentation** (Crit√®re 10) - CSS vs HTML
11. **Forms** (Crit√®re 11) - Labels, error messages
12. **Navigation** (Crit√®re 12) - Skip links, breadcrumbs
13. **Consultation** (Crit√®re 13) - Downloadable documents

### Step 4: Calculate Score

```
Score = (Passed Tests / Total Tests) √ó 100
```

Compliance levels:

- **100%** - Fully compliant
- **‚â• 95%** - Substantially compliant
- **‚â• 75%** - Partially compliant
- **< 75%** - Non-compliant

### Step 5: Generate Report

Write Markdown report to `$REPORT_FILE`:

```markdown
# Accessibility Audit Report

**URL:** $URL
**Date:** {date}
**Standard:** RGAA 4.1 / WCAG 2.1 Level AA

## Executive Summary

- **Score:** XX/100
- **Level:** [Fully/Substantially/Partially/Non] Compliant
- **Critical Issues:** X
- **Warnings:** X
- **Total Issues:** X

## Issues by Severity

### üî¥ ERROR (Critical - Must Fix)

1. **[Criterion X.X] Issue Title**
   - **Description:** What's wrong
   - **Location:** Page section / Element selector
   - **Impact:** Who is affected and how
   - **Solution:** How to fix it
   - **WCAG Ref:** [Success Criterion X.X.X]

### üü° WARNING (Important - Should Fix)

...

### üîµ INFO (Enhancement - Nice to Have)

...

## Detailed Findings by RGAA Criteria

### Crit√®re 1: Images
- Total checks: X
- Passed: X
- Failed: X
- Issues: [list]

### Crit√®re 2: Cadres
...

[Continue for all 13 criteria]

## WCAG 2.1 Compliance

### Level A
- ‚úÖ Passed: X/X
- ‚ùå Failed: X/X

### Level AA
- ‚úÖ Passed: X/X
- ‚ùå Failed: X/X

## Recommendations (Prioritized)

### Quick Wins (Low Effort, High Impact)
1. [Recommendation with estimated time]

### High Priority (Medium Effort, High Impact)
1. [Recommendation]

### Long-Term Improvements
1. [Recommendation]

## Testing Tools Used

- Tool: axe-core v.X.X
- Tool: pa11y v.X.X
- Manual: RGAA 4.1 checklist

## Next Steps

1. Fix all ERROR level issues immediately
2. Address WARNING issues in next sprint
3. Plan for INFO improvements in roadmap
4. Schedule follow-up audit after fixes

---
*Generated by audit-checker plugin on {timestamp}*
```

### Step 6: Display Summary

Output concise summary to user:

```
‚ôø Accessibility Audit Complete

Score: XX/100 - [Compliance Level]

Critical Issues: X
Warnings: X
Info: X

Full report: $REPORT_FILE

Top 3 Issues:
1. [Issue title] (ERROR)
2. [Issue title] (WARNING)
3. [Issue title] (WARNING)

Quick Wins:
- [Action] (~5 min)
- [Action] (~10 min)
```

## Execution Strategy

### CLI Detection

```bash
# Check for available tools
HAS_AXE=$(command -v axe &> /dev/null && echo "yes" || echo "no")
HAS_PA11Y=$(command -v pa11y &> /dev/null && echo "yes" || echo "no")
HAS_LIGHTHOUSE=$(command -v lighthouse &> /dev/null && echo "yes" || echo "no")

# Prefer axe-core > pa11y > lighthouse > MCP > Agent
```

### MCP Fallback

If no CLI tools available, use Chrome DevTools MCP:

1. Open page in Chrome
2. Get accessibility tree
3. Check ARIA attributes
4. Validate heading structure
5. Test keyboard navigation
6. Verify color contrast

### Agent Fallback

If MCP unavailable, use a11y-auditor agent for manual inspection.

## Usage Examples

### Basic Audit

```bash
/audit-a11y https://example.com
```

### Custom Output

```bash
/audit-a11y https://example.com --output ./reports/a11y/
```

### Help

```bash
/audit-a11y --help
```

## RGAA 4.1 Reference

Use the skill reference file:

```bash
skills/audit-methodology/reference/rgaa-criteria.md
```

## Notes

- RGAA 4.1 has 106 criteria organized in 13 thematic groups
- This audit covers WCAG 2.1 Level AA compliance
- Manual testing required for some criteria (keyboard navigation, screen reader)
- Report includes severity levels: ERROR > WARNING > INFO > PASS
- Critical issues should be fixed before site launch
